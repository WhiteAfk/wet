<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="M√£ QR thanh to√°n MB Bank">
    <meta name="keywords" content="QR Code, Thanh to√°n">
    <meta property="og:title" content="M√£ QR Thanh to√°n">
    <link rel="canonical" href="https://wet-dev.netlify.app/qr-result.html">
    <link rel="stylesheet" href="css/global.css">
    <link rel="stylesheet" href="css/qr-result.css">
    <title>M√£ QR Thanh to√°n | wET</title>
</head>
<body>
    <div class="copy-notification" role="alert" aria-live="polite">
        <span>‚úÖ ƒê√£ sao ch√©p!</span>
    </div>

    <div class="qr-container">
        <header class="qr-header">
            <h1>üì± M√£ QR Chuy·ªÉn Kho·∫£n</h1>
        </header>

        <main class="qr-main">
            <div class="qr-display" id="qrDisplay">
                <img id="qrImage" alt="QR Code" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='280' height='280'%3E%3Crect fill='%23f0f0f0' width='280' height='280'/%3E%3Ctext x='50%25' y='50%25' text-anchor='middle' dominant-baseline='middle' font-size='14' fill='%23999' transform='translate(0,-8)'%3ET·∫£i QR...%3C/text%3E%3C/svg%3E" draggable="false">
            </div>

            <div class="qr-info">
                <div class="info-group">
                    <div class="info-item">
                        <span class="label">Ng√¢n h√†ng</span>
                        <span class="value">MB Bank</span>
                    </div>
                    <div class="info-item">
                        <span class="label">S·ªë TK</span>
                        <span class="value copy-btn" onclick="copyToClipboard('5088882345', 's·ªë t√†i kho·∫£n')">5088882345</span>
                    </div>
                    <div class="info-item">
                        <span class="label">Ch·ªß TK</span>
                        <span class="value copy-btn" onclick="copyToClipboard('V√µ Anh Vƒ©nh K·ª≥', 't√™n')">V√µ Anh Vƒ©nh K·ª≥</span>
                    </div>
                </div>

                <div class="amount-info">
                    <div class="amount-item">
                        <span class="label">S·ªë ti·ªÅn</span>
                        <span class="amount" id="amountDisplay">--</span>
                    </div>
                    <div class="amount-item">
                        <span class="label">N·ªôi dung</span>
                        <span class="message" id="messageDisplay">--</span>
                    </div>
                </div>

                <div class="action-buttons">
                    <button class="btn-copy" onclick="copyTransferInfo()">üìã Copy</button>
                    <button class="btn-download" onclick="downloadQR()">‚¨áÔ∏è T·∫£i</button>
                </div>
            </div>
        </main>

        <footer class="qr-footer">
            <a href="donate.html">‚Üê Donate</a>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const qrDisplay = document.getElementById('qrDisplay');
            const qrImage = document.getElementById('qrImage');

            qrDisplay.addEventListener('contextmenu', (e) => e.preventDefault());
            
            qrImage.addEventListener('dragstart', (e) => e.preventDefault());
            qrImage.addEventListener('drag', (e) => e.preventDefault());
            
            qrDisplay.addEventListener('copy', (e) => e.preventDefault());
            
            qrDisplay.addEventListener('mousedown', (e) => {
                if (e.button === 2) e.preventDefault();
                if (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'C')) e.preventDefault();
            });

            qrImage.addEventListener('mousedown', (e) => {
                if (e.button === 2) e.preventDefault();
            });
        });
            navigator.clipboard.writeText(text).then(() => {
                const n = document.querySelector('.copy-notification');
                if (n) {
                    n.classList.add('show');
                    n.querySelector('span').textContent = `‚úÖ ƒê√£ sao ch√©p ${type}!`;
                    setTimeout(() => n.classList.remove('show'), 2000);
                }
            }).catch(() => alert('Copy th·∫•t b·∫°i'));
        }

        function getQueryParam(param) {
            return new URLSearchParams(window.location.search).get(param);
        }

        function copyTransferInfo() {
            const amount = document.getElementById('amountDisplay').textContent;
            const message = document.getElementById('messageDisplay').textContent;
            const text = `MB Bank\nS·ªë TK: 5088882345\nCh·ªß TK: V√µ Anh Vƒ©nh K·ª≥\nS·ªë ti·ªÅn: ${amount}\nN·ªôi dung: ${message}`;
            navigator.clipboard.writeText(text).then(() => {
                const n = document.querySelector('.copy-notification');
                if (n) {
                    n.classList.add('show');
                    n.querySelector('span').textContent = '‚úÖ ƒê√£ sao ch√©p th√¥ng tin!';
                    setTimeout(() => n.classList.remove('show'), 2000);
                }
            });
        }

        function downloadQR() {
            const img = document.getElementById('qrImage');
            if (!img || !img.src) { alert('QR ch∆∞a s·∫µn s√†ng'); return; }
            
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const newImg = new Image();
            newImg.crossOrigin = 'anonymous';
            newImg.onload = () => {
                canvas.width = newImg.width;
                canvas.height = newImg.height;
                ctx.drawImage(newImg, 0, 0);
                canvas.toBlob(blob => {
                    const url = URL.createObjectURL(blob);
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = `QR_${Date.now()}.png`;
                    link.click();
                    URL.revokeObjectURL(url);
                    const n = document.querySelector('.copy-notification');
                    if (n) {
                        n.classList.add('show');
                        n.querySelector('span').textContent = '‚úÖ T·∫£i xu·ªëng th√†nh c√¥ng!';
                        setTimeout(() => n.classList.remove('show'), 2000);
                    }
                }, 'image/png');
            };
            newImg.onerror = () => {
                const link = document.createElement('a');
                link.href = img.src;
                link.download = `QR_${Date.now()}.png`;
                link.click();
            };
            newImg.src = img.src;
        }

        document.addEventListener('DOMContentLoaded', () => {
            const amount = getQueryParam('amount');
            const addInfo = getQueryParam('addInfo');

            if (amount && addInfo) {
                const formatted = parseInt(amount).toLocaleString('vi-VN');
                document.getElementById('amountDisplay').textContent = formatted + ' VNƒê';
                document.getElementById('messageDisplay').textContent = decodeURIComponent(addInfo);

                const accountNo = '5088882345';
                const accountName = 'Vo Anh Vinh Ky';
                const qrUrl = `https://img.vietqr.io/image/MBBank-${accountNo}-qr_only.png?amount=${amount}&addInfo=${encodeURIComponent(addInfo)}&accountName=${encodeURIComponent(accountName)}`;
                
                const qrImg = document.getElementById('qrImage');
                qrImg.src = qrUrl;
                qrImg.onerror = () => {
                    const fallback = `https://qr-server.com/api/qr?size=280x280&data=${encodeURIComponent('00020126360014com.vietqr01051000370406' + accountNo + '0712' + accountName + '52040000530398540' + amount + '9627302011200067050300000000000063048B8D')}`;
                    qrImg.src = fallback;
                };
            } else {
                setTimeout(() => window.location.href = 'donate.html', 1000);
            }
        });
    </script>
    <script src="js/animations.js" defer></script>
</body>
</html>
